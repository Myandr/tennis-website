<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Galerie - Hardter Tennisverein</title>
  <link rel="stylesheet" type="text/css" href="../../static/css/index2.css" />
  <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" />
  <style>
    main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .page-title {
      text-align: center;
      margin: 30px 0;
    }

    .page-title h1 {
      font-size: 2.5rem;
      color: #333;
      position: relative;
      display: inline-block;
    }

    .page-title h1::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 3px;
      background-color: #8cc63f;
    }

    /* Tabs */
    .gallery-tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 30px;
      border-bottom: 1px solid #e0e0e0;
    }

    .gallery-tab {
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 500;
      color: #666;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      transition: all 0.3s;
    }

    .gallery-tab:hover {
      color: #8cc63f;
    }

    .gallery-tab.active {
      color: #8cc63f;
      border-bottom-color: #8cc63f;
    }

    /* Section titles */
    .section-title {
      font-size: 1.8rem;
      color: #333;
      margin: 40px 0 20px;
      text-align: center;
      position: relative;
    }

    .section-title::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background-color: #8cc63f;
    }

    /* Gallery styles */
    .gallery-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 40px;
    }

    .gallery-item {
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
      cursor: pointer;
      position: relative;
    }

    .gallery-item:hover {
      transform: translateY(-5px);
    }

    .gallery-img {
      width: 100%;
      height: 300px;
      object-fit: cover;
      display: block;
    }

    .gallery-caption {
      padding: 10px;
      background-color: #fff;
      text-align: center;
      font-weight: 500;
    }

    /* Galleries grid */
    .galleries-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 25px;
      margin-top: 40px;
    }

    .gallery-card {
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      background-color: white;
      position: relative;
    }

    .gallery-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .gallery-cover {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
    }

    .gallery-info {
      padding: 20px;
    }

    .gallery-name {
      font-size: 1.5rem;
      margin: 0 0 10px 0;
      color: #333;
    }

    .gallery-description {
      color: #666;
      margin-bottom: 15px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .gallery-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #888;
      font-size: 0.9rem;
    }

    .gallery-btn {
      display: inline-block;
      padding: 8px 16px;
      background-color: #8cc63f;
      color: white;
      text-decoration: none;
      border-radius: 20px;
      font-weight: 500;
      transition: background-color 0.2s;
    }

    .gallery-btn:hover {
      background-color: #7ab52f;
    }

    /* Lightbox styles */
    .lightbox {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .lightbox-content {
      position: relative;
      max-width: 90%;
      max-height: 80%;
      display: flex;
      align-items: center;
    }

    .lightbox-img {
      max-width: 100%;
      max-height: 80vh;
      object-fit: contain;
    }

    .close-btn {
      position: absolute;
      top: 20px;
      right: 30px;
      color: white;
      font-size: 40px;
      cursor: pointer;
      z-index: 1001;
    }

    .arrow {
      color: white;
      font-size: 30px;
      cursor: pointer;
      padding: 15px;
      user-select: none;
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 50%;
      margin: 0 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s;
    }

    .arrow:hover {
      background-color: rgba(0, 0, 0, 0.8);
    }

    .lightbox-caption {
      color: white;
      text-align: center;
      padding: 20px;
      max-width: 80%;
      font-size: 18px;
    }

    /* Admin controls */
    .admin-controls {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 100;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .admin-btn {
      background-color: white;
      color: #333;
      border: none;
      border-radius: 12px;
      width: 50px;
      height: 50px;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      opacity: 1;
    }

    .admin-btn:hover {
      transform: translateY(-3px);
      opacity: 1;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
    }

    .admin-btn.edit-mode {
      background-color: #8cc63f;
      color: white;
    }

    .admin-btn.add-image {
      background-color: white;
      color: #2196F3;
    }

    .admin-btn.add-gallery {
      background-color: white;
      color: #ff9800;
    }

    /* Image controls in edit mode */
    .image-controls {
      position: absolute;
      top: 10px;
      right: 10px;
      display: none;
      gap: 8px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .edit-mode .gallery-item:hover .image-controls,
    .edit-mode .gallery-card:hover .gallery-controls {
      display: flex;
      opacity: 1;
    }

    .image-control-btn {
      background-color: white;
      color: #333;
      border: none;
      border-radius: 8px;
      width: 36px;
      height: 36px;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      transition: all 0.2s ease;
    }

    .image-control-btn:hover {
      transform: scale(1.1);
    }

    .edit-btn {
      color: #2196F3;
    }

    .delete-btn {
      color: #f44336;
    }

    /* Gallery controls */
    .gallery-controls {
      position: absolute;
      top: 10px;
      right: 10px;
      display: none;
      gap: 8px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .gallery-card:hover .gallery-controls {
      display: flex;
      opacity: 1;
    }

    /* Category filter */
    .category-filter {
      display: flex;
      justify-content: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .category-btn {
      padding: 8px 16px;
      background-color: #f1f1f1;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .category-btn:hover, .category-btn.active {
      background-color: #8cc63f;
      color: white;
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      background-color: #f9f9f9;
      border-radius: 12px;
      margin-top: 40px;
    }

    .empty-state-icon {
      font-size: 60px;
      color: #ccc;
      margin-bottom: 20px;
    }

    .empty-state-title {
      font-size: 24px;
      color: #666;
      margin-bottom: 10px;
    }

    .empty-state-text {
      color: #888;
      margin-bottom: 30px;
    }

    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: white;
      padding: 30px;
      border-radius: 16px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 1px solid #f0f0f0;
    }

    .modal-title {
      font-size: 24px;
      font-weight: 600;
      color: #333;
      margin: 0;
    }

    .modal-close {
      font-size: 24px;
      cursor: pointer;
      background: none;
      border: none;
      color: #999;
      transition: color 0.2s;
    }

    .modal-close:hover {
      color: #333;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #555;
    }

   

    .form-control {
      width: 100%;
      padding: 12px;
      border: 1px solid #666666;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .form-control:focus {
      border-color: #0e0e0e;
      outline: none;
      box-shadow: 0 0 0 3px rgba(140, 198, 63, 0.1);
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-primary {
      background-color: #8cc63f;
      color: white;
    }

    .btn-primary:hover {
      background-color: #7ab52f;
      transform: translateY(-2px);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }

    .btn-danger {
      background-color: #f5f5f5;
      color: #f44336;
    }

    .btn-danger:hover {
      background-color: #fafafa;
      color: #d32f2f;
      transform: translateY(-2px);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }

    .image-preview {
      margin-top: 10px;
      max-width: 100%;
      max-height: 200px;
      display: none;
    }

    /* Bulk upload styles */
    .bulk-upload-container {
      background-color: #f9f9f9;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 30px;
      display: none;
    }

    .drop-zone {
      border: 2px dashed #ddd;
      border-radius: 8px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .drop-zone:hover {
      border-color: #8cc63f;
      background-color: #f0f8e6;
    }

    .drop-zone.active {
      border-color: #8cc63f;
      background-color: #f0f8e6;
    }

    .drop-zone-text {
      font-size: 16px;
      color: #666;
      margin-bottom: 10px;
    }

    .drop-zone-icon {
      font-size: 30px;
      color: #8cc63f;
      margin-bottom: 10px;
    }

    .preview-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 20px;
    }

    .preview-item {
      position: relative;
      border-radius: 4px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .preview-img {
      width: 100%;
      height: 120px;
      object-fit: cover;
    }

    .preview-remove {
      position: absolute;
      top: 5px;
      right: 5px;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      border: none;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .preview-remove:hover {
      background-color: rgba(0, 0, 0, 0.9);
    }

    .alert {
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
    }

    .alert-success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .alert-danger {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .alert-close {
      float: right;
      font-size: 20px;
      font-weight: bold;
      line-height: 20px;
      cursor: pointer;
    }

    /* Content sections */
    .content-section {
      display: none;
    }

    .content-section.active {
      display: block;
    }

    @media (max-width: 1308px) {
      .gallery-container, .galleries-container {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      }

      .arrow {
        padding: 10px;
        font-size: 24px;
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        z-index: 1002;
        margin: 0;
        background-color: rgba(0, 0, 0, 0.7);
      }

      .prev-arrow {
        left: 10px;
      }

      .next-arrow {
        right: 10px;
      }
    }

    @media (max-width: 768px) {
      .gallery-container, .galleries-container {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      }

      .gallery-tabs {
        flex-wrap: wrap;
      }

      .gallery-tab {
        padding: 10px 16px;
        font-size: 14px;
      }
    }

    /* F√ºge einen visuellen Indikator f√ºr den Bearbeitungsmodus hinzu */
    .edit-mode-indicator {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #8cc63f;
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      z-index: 99;
      display: none;
      align-items: center;
      gap: 8px;
    }

    .edit-mode .edit-mode-indicator {
      display: flex;
    }

    /* Verbessere die Galerie-Items im Bearbeitungsmodus */
    .edit-mode .gallery-item,
    .edit-mode .gallery-card {
      position: relative;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .edit-mode .gallery-item:hover,
    .edit-mode .gallery-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
    }

    .edit-mode .gallery-item::before,
    .edit-mode .gallery-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.05);
      border-radius: 8px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .edit-mode .gallery-item:hover::before,
    .edit-mode .gallery-card:hover::before {
      opacity: 1;
    }

    .selection-mode .gallery-item {
      position: relative;
      cursor: pointer;
    }
    
    .selection-mode .gallery-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.3);
      z-index: 5;
      opacity: 0;
      transition: opacity 0.2s;
    }
    
    .selection-mode .gallery-item:hover::before {
      opacity: 1;
    }
    
    .selection-mode .gallery-item.selected::before {
      opacity: 0;
    }
    
    .selection-mode .gallery-item.selected {
      box-shadow: 0 0 0 3px #8cc63f, 0 3px 10px rgba(0, 0, 0, 0.1);
    }
    
    .selection-mode .gallery-item.selected::after {
      content: '‚úì';
      position: absolute;
      top: 10px;
      right: 10px;
      width: 30px;
      height: 30px;
      background-color: #8cc63f;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      z-index: 6;
    }
    
    .selection-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #f9f9f9;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }
    
    .selection-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    #selected-count {
      font-weight: 600;
      color: #8cc63f;
    }
    
    .selection-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    #gallery-select {
      min-width: 200px;
    }
    
    .btn-sm {
      padding: 8px 16px;
      font-size: 14px;
    }
  </style>
</head>

<body>
  {% include 'design1/navbar.html' %}

  <section class="locations-section" style="background-color: white; color: black; " id="about1">
    <div class="locations-header">
      <h2>üéæ‚ú® Galerie - Unsere Tennismomente ‚ú®üéæ</h2>
      <p>Entdecken Sie die sch√∂nsten Momente aus unserem Vereinsleben</p>
    </div>
  </section>

  <main class="locations-section" style="background-color: white; color: black; margin-top: -200px; ">
    <!-- Tabs f√ºr die Navigation zwischen Bildern und Galerien -->
    <div class="gallery-tabs">
      <button class="gallery-tab active" data-tab="images">Alle Bilder</button>
      <button class="gallery-tab" data-tab="galleries">Fotogalerien</button>
    </div>

    <!-- Bereich f√ºr alle Bilder -->
    <div id="images-section" class="content-section active">
      <!-- Kategorie-Filter -->
      <div class="category-filter" id="category-filter">
        <button class="category-btn active" data-category="all">Alle</button>
        <!-- Kategorien werden dynamisch hinzugef√ºgt -->
      </div>
      <div class="selection-controls" style="display: none;">
        <div class="selection-info">
          <span id="selected-count">0</span> Bilder ausgew√§hlt
          <button id="cancel-selection" class="btn btn-sm">Abbrechen</button>
        </div>
        <div class="selection-actions">
          <select id="gallery-select" class="form-control">
            <option value="">-- Galerie ausw√§hlen --</option>
            {% for gallery in galleries %}
            <option value="{{ gallery.id }}">{{ gallery.name }}</option>
            {% endfor %}
          </select>
          <button id="move-to-gallery" class="btn btn-primary btn-sm" disabled>In Galerie verschieben</button>
        </div>
      </div>

      <div class="gallery-container" id="gallery-container">
        <!-- Bilder werden dynamisch geladen -->
        {% for image in gallery_images %}
        <div class="gallery-item" data-category="{{ image.category }}">
          <img src="{{ image.image_path }}" alt="{{ image.title }}" class="gallery-img">
          <div class="gallery-caption">{{ image.title }}</div>
          <div class="image-controls">
            <button class="image-control-btn edit-btn" data-id="{{ image.id }}" title="Bearbeiten">‚úèÔ∏è</button>
            <button class="image-control-btn delete-btn" data-id="{{ image.id }}" title="L√∂schen">üóëÔ∏è</button>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Bereich f√ºr Galerien -->
    <div id="galleries-section" class="content-section">
      <h3 class="section-title">Unsere Fotogalerien</h3>

      
      <div class="galleries-container" id="galleries-container">
        {% if galleries %}
          {% for gallery in galleries %}
          <div class="gallery-card">
            <a href="{{ url_for('view_gallery', slug=gallery.slug) }}">
              <img src="{{ gallery.cover_image or '/static/images/placeholder-gallery.jpg' }}" alt="{{ gallery.name }}" class="gallery-cover">
            </a>
            <div class="gallery-info">
              <h3 class="gallery-name">{{ gallery.name }}</h3>
              <p class="gallery-description">{{ gallery.description or 'Keine Beschreibung verf√ºgbar' }}</p>
              <div class="gallery-meta">
                <span>{{ gallery.images|length }} Bilder</span>
                <a href="{{ url_for('view_gallery', slug=gallery.slug) }}" class="gallery-btn">Ansehen</a>
              </div>
            </div>
            {% if is_admin %}
            <div class="gallery-controls">
              <button class="image-control-btn edit-btn" data-id="{{ gallery.id }}" title="Bearbeiten">‚úèÔ∏è</button>
              <button class="image-control-btn delete-btn" data-id="{{ gallery.id }}" title="L√∂schen">üóëÔ∏è</button>
            </div>
            {% endif %}
          </div>
          {% endfor %}
        {% else %}
          <div class="empty-state" style="grid-column: 1 / -1;">
            <div class="empty-state-icon">üì∑</div>
            <h3 class="empty-state-title">Keine Galerien gefunden</h3>
            <p class="empty-state-text">Es wurden noch keine Fotogalerien erstellt.</p>
            {% if is_admin %}
            <button id="create-first-gallery" class="btn btn-primary">Erste Galerie erstellen</button>
            {% endif %}
          </div>
        {% endif %}
      </div>
    </div>
  </main>

  <!-- Lightbox f√ºr Bildanzeige -->
  <div class="lightbox" id="lightbox">
    <span class="close-btn">&times;</span>
    <div class="lightbox-content">
      <div class="arrow prev-arrow">&#10094;</div>
      <img src="/placeholder.svg" alt="" class="lightbox-img" id="lightbox-img">
      <div class="arrow next-arrow">&#10095;</div>
    </div>
    <div class="lightbox-caption"></div>
  </div>

  <!-- Admin-Steuerelemente -->
  {% if is_admin %}
  <div class="admin-controls">
    <button id="toggle-edit-mode" class="admin-btn" title="Bearbeitungsmodus">‚úèÔ∏è</button>
    <button id="add-image-btn" class="admin-btn add-image" title="Bild hinzuf√ºgen">+</button>
    <button id="add-gallery-btn" class="admin-btn add-gallery" title="Neue Galerie erstellen">üìÅ</button>
    <button id="select-images-btn" class="admin-btn select-images" title="Bilder ausw√§hlen">‚òëÔ∏è</button>
  </div>

  <div class="edit-mode-indicator">
    <span>Bearbeitungsmodus</span>
  </div>
  {% endif %}

  <!-- Modal f√ºr Bildbearbeitung -->
  <div class="modal" id="image-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modal-title" style="color: black;">Bild bearbeiten</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="image-form">
        <input type="hidden" id="image-id">
        <div class="form-group">
          <label for="image-title" style="color: black;">Titel</label>
          <input type="text" id="image-title" class="form-control" required>
        </div>
        <div class="form-group">
          <label for="image-description" style="color: black;">Beschreibung</label>
          <textarea id="image-description" class="form-control" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label for="image-category" style="color: black;">Kategorie</label>
          <input type="text" id="image-category" class="form-control" placeholder="z.B. Turniere, Training, Events">
        </div>
        <div class="form-group">
          <label for="image-order" style="color: black;">Anzeigereihenfolge</label>
          <input type="number" id="image-order" class="form-control" min="0" value="0">
        </div>
        <div class="form-group">
          <label for="image-file" style="color: black;">Bild</label>
          <input type="file" id="image-file" class="form-control" accept="image/*">
          <img id="image-preview" class="image-preview" src="/placeholder.svg" alt="Vorschau">
        </div>
        <div style="display: flex; justify-content: space-between; margin-top: 20px;">
          <button type="button" class="btn btn-danger" id="cancel-btn">Abbrechen</button>
          <button type="submit" class="btn btn-primary">Speichern</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal f√ºr Galerie erstellen/bearbeiten -->
  <div class="modal" id="gallery-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="gallery-modal-title">Neue Galerie erstellen</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="gallery-form">
        <input type="hidden" id="gallery-id">
        <div class="form-group">
          <label for="gallery-name" style="color: black;">Name der Galerie</label>
          <input type="text" id="gallery-name" class="form-control" required>
        </div>
        <div class="form-group">
          <label for="gallery-description" style="color: black;">Beschreibung</label>
          <textarea id="gallery-description" class="form-control" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label for="gallery-cover" style="color: black;">Titelbild</label>
          <input type="file" id="gallery-cover" class="form-control" accept="image/*">
          <img id="cover-preview" class="image-preview" src="/placeholder.svg" alt="Vorschau">
        </div>
        <div style="display: flex; justify-content: space-between; margin-top: 20px;">
          <button type="button" class="btn btn-danger" id="gallery-cancel-btn">Abbrechen</button>
          <button type="submit" class="btn btn-primary">Speichern</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Best√§tigungsmodal f√ºr L√∂schung -->
  <div class="modal" id="confirm-modal">
    <div class="modal-content" style="max-width: 400px;">
      <div class="modal-header">
        <h3 class="modal-title" id="confirm-title">L√∂schen</h3>
        <button class="modal-close">&times;</button>
      </div>
      <p id="confirm-message">Sind Sie sicher, dass Sie dieses Element l√∂schen m√∂chten? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.</p>
      <div style="display: flex; justify-content: space-between; margin-top: 20px;">
        <button type="button" class="btn btn-primary" id="cancel-delete-btn">Abbrechen</button>
        <button type="button" class="btn btn-danger" id="confirm-delete-btn">L√∂schen</button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Tabs
      const tabs = document.querySelectorAll('.gallery-tab');
      const contentSections = document.querySelectorAll('.content-section');
      
      tabs.forEach(tab => {
        tab.addEventListener('click', function() {
          // Aktiven Tab markieren
          tabs.forEach(t => t.classList.remove('active'));
          this.classList.add('active');
          
          // Entsprechenden Inhaltsbereich anzeigen
          const tabId = this.dataset.tab;
          contentSections.forEach(section => {
            section.classList.remove('active');
          });
          document.getElementById(`${tabId}-section`).classList.add('active');
        });
      });
      
      // Elemente
      const galleryContainer = document.getElementById('gallery-container');
      const galleriesContainer = document.getElementById('galleries-container');
      const lightbox = document.getElementById('lightbox');
      const lightboxImg = document.getElementById('lightbox-img');
      const lightboxCaption = document.querySelector('.lightbox-caption');
      const closeBtn = document.querySelector('.close-btn');
      const prevArrow = document.querySelector('.prev-arrow');
      const nextArrow = document.querySelector('.next-arrow');
      const categoryFilter = document.getElementById('category-filter');
      
      // Admin-Elemente
      {% if is_admin %}
      const toggleEditModeBtn = document.getElementById('toggle-edit-mode');
      const addImageBtn = document.getElementById('add-image-btn');
      const addGalleryBtn = document.getElementById('add-gallery-btn');
      const createFirstGalleryBtn = document.getElementById('create-first-gallery');
      const imageModal = document.getElementById('image-modal');
      const galleryModal = document.getElementById('gallery-modal');
      const confirmModal = document.getElementById('confirm-modal');
      const imageForm = document.getElementById('image-form');
      const galleryForm = document.getElementById('gallery-form');
      const imageIdInput = document.getElementById('image-id');
      const galleryIdInput = document.getElementById('gallery-id');
      const imageTitleInput = document.getElementById('image-title');
      const imageDescriptionInput = document.getElementById('image-description');
      const imageCategoryInput = document.getElementById('image-category');
      const imageOrderInput = document.getElementById('image-order');
      const imageFileInput = document.getElementById('image-file');
      const galleryNameInput = document.getElementById('gallery-name');
      const galleryDescriptionInput = document.getElementById('gallery-description');
      const galleryCoverInput = document.getElementById('gallery-cover');
      const imagePreview = document.getElementById('image-preview');
      const coverPreview = document.getElementById('cover-preview');
      const modalTitle = document.getElementById('modal-title');
      const galleryModalTitle = document.getElementById('gallery-modal-title');
      const confirmTitle = document.getElementById('confirm-title');
      const confirmMessage = document.getElementById('confirm-message');
      const cancelBtn = document.getElementById('cancel-btn');
      const galleryCancelBtn = document.getElementById('gallery-cancel-btn');
      const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
      const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
      const modalCloseButtons = document.querySelectorAll('.modal-close');
      
      let isEditMode = false;
      let currentImageId = null;
      let currentGalleryId = null;
      let deleteType = 'image'; // 'image' oder 'gallery'
      {% endif %}
      
      // Lightbox-Variablen
      let currentIndex = 0;
      const images = [];
      const captions = [];
      const descriptions = [];
      
      // Alle Bilder und Beschriftungen sammeln
      function collectGalleryItems() {
        images.length = 0;
        captions.length = 0;
        descriptions.length = 0;
        
        const visibleItems = document.querySelectorAll('.gallery-item:not([style*="display: none"])');
        
        visibleItems.forEach((item, index) => {
          const img = item.querySelector('.gallery-img');
          const caption = item.querySelector('.gallery-caption');
          
          images.push(img.src);
          captions.push(caption.textContent);
          descriptions.push(item.dataset.description || '');
          
          // Klickereignis zum √ñffnen der Lightbox hinzuf√ºgen
          img.addEventListener('click', function(e) {
            {% if is_admin %}
            if (isEditMode) return; // Im Bearbeitungsmodus nicht √∂ffnen
            {% endif %}
            openLightbox(index);
          });
        });
      }
      
      // Lightbox √∂ffnen
      function openLightbox(index) {
        currentIndex = index;
        lightboxImg.src = images[currentIndex];
        lightboxCaption.textContent = descriptions[currentIndex] || captions[currentIndex];
        lightbox.style.display = 'flex';
        document.body.style.overflow = 'hidden';
      }
      
      // Lightbox schlie√üen
      function closeLightbox() {
        lightbox.style.display = 'none';
        document.body.style.overflow = 'auto';
      }
      
      // Vorheriges Bild anzeigen
      function showPrevImage() {
        currentIndex = (currentIndex - 1 + images.length) % images.length;
        lightboxImg.src = images[currentIndex];
        lightboxCaption.textContent = descriptions[currentIndex] || captions[currentIndex];
      }
      
      // N√§chstes Bild anzeigen
      function showNextImage() {
        currentIndex = (currentIndex + 1) % images.length;
        lightboxImg.src = images[currentIndex];
        lightboxCaption.textContent = descriptions[currentIndex] || captions[currentIndex];
      }
      
      // Ereignislistener
      closeBtn.addEventListener('click', closeLightbox);
      prevArrow.addEventListener('click', showPrevImage);
      nextArrow.addEventListener('click', showNextImage);
      
      // Lightbox schlie√üen, wenn au√üerhalb des Bildes geklickt wird
      lightbox.addEventListener('click', function(e) {
        if (e.target === lightbox) {
          closeLightbox();
        }
      });
      
      // Tastaturnavigation
      document.addEventListener('keydown', function(e) {
        if (lightbox.style.display === 'flex') {
          if (e.key === 'Escape') {
            closeLightbox();
          } else if (e.key === 'ArrowLeft') {
            showPrevImage();
          } else if (e.key === 'ArrowRight') {
            showNextImage();
          }
        }
      });
      
      // Kategorien laden und Filter erstellen
      function loadCategories() {
        const categories = new Set();
        document.querySelectorAll('.gallery-item').forEach(item => {
          const category = item.dataset.category;
          if (category) {
            categories.add(category);
          }
        });
        
        // Kategoriefilter erstellen
        categoryFilter.innerHTML = '<button class="category-btn active" data-category="all">Alle</button>';
        categories.forEach(category => {
          const button = document.createElement('button');
          button.className = 'category-btn';
          button.dataset.category = category;
          button.textContent = category;
          categoryFilter.appendChild(button);
        });
        
        // Ereignislistener f√ºr Kategoriefilter
        document.querySelectorAll('.category-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            // Aktiven Button markieren
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            const category = this.dataset.category;
            
            // Bilder filtern
            document.querySelectorAll('.gallery-item').forEach(item => {
              if (category === 'all' || item.dataset.category === category) {
                item.style.display = '';
              } else {
                item.style.display = 'none';
              }
            });
            
            // Bilder f√ºr Lightbox neu sammeln
            collectGalleryItems();
          });
        });
      }
      
      // Initial Bilder f√ºr Lightbox sammeln
      collectGalleryItems();
      
      // Kategorien laden
      loadCategories();
      
      {% if is_admin %}
      // Bearbeitungsmodus umschalten
      toggleEditModeBtn.addEventListener('click', function() {
        isEditMode = !isEditMode;
        document.body.classList.toggle('edit-mode', isEditMode);
        toggleEditModeBtn.innerHTML = isEditMode ? '‚úì' : '‚úèÔ∏è';
        toggleEditModeBtn.classList.toggle('edit-mode', isEditMode);
      });
      
      // Bild hinzuf√ºgen
      addImageBtn.addEventListener('click', function() {
        openAddImageModal();
      });
      
      function openAddImageModal() {
        // Formular zur√ºcksetzen
        imageForm.reset();
        imageIdInput.value = '';
        imagePreview.style.display = 'none';
        modalTitle.textContent = 'Neues Bild hinzuf√ºgen';
        
        // Modal √∂ffnen
        imageModal.style.display = 'flex';
      }
      
      // Galerie hinzuf√ºgen
      addGalleryBtn.addEventListener('click', function() {
        openAddGalleryModal();
      });
      
      if (createFirstGalleryBtn) {
        createFirstGalleryBtn.addEventListener('click', function() {
          openAddGalleryModal();
        });
      }
      
      function openAddGalleryModal(galleryId = null) {
        // Formular zur√ºcksetzen
        galleryForm.reset();
        galleryIdInput.value = '';
        coverPreview.style.display = 'none';
        
        if (galleryId) {
          // Galerie bearbeiten
          currentGalleryId = galleryId;
          galleryModalTitle.textContent = 'Galerie bearbeiten';
          
          // Galerie-Daten laden
          fetch(`/api/galleries/${galleryId}`)
            .then(response => response.json())
            .then(gallery => {
              galleryIdInput.value = gallery.id;
              galleryNameInput.value = gallery.name;
              galleryDescriptionInput.value = gallery.description || '';
              
              if (gallery.cover_image) {
                coverPreview.src = gallery.cover_image;
                coverPreview.style.display = 'block';
              }
            })
            .catch(error => {
              console.error('Fehler beim Laden der Galerie-Daten:', error);
              alert('Fehler beim Laden der Galerie-Daten. Bitte versuchen Sie es sp√§ter erneut.');
            });
        } else {
          // Neue Galerie erstellen
          currentGalleryId = null;
          galleryModalTitle.textContent = 'Neue Galerie erstellen';
        }
        
        // Modal √∂ffnen
        galleryModal.style.display = 'flex';
      }
      
      // Bearbeitungsmodal √∂ffnen
      function openEditModal(imageId) {
        currentImageId = imageId;
        
        // Bilddaten laden
        fetch(`/api/gallery/${imageId}`)
          .then(response => response.json())
          .then(image => {
            imageIdInput.value = image.id;
            imageTitleInput.value = image.title;
            imageDescriptionInput.value = image.description || '';
            imageCategoryInput.value = image.category || '';
            imageOrderInput.value = image.display_order || 0;
            
            // Bildvorschau anzeigen
            imagePreview.src = image.image_path;
            imagePreview.style.display = 'block';
            
            modalTitle.textContent = 'Bild bearbeiten';
            imageModal.style.display = 'flex';
          })
          .catch(error => {
            console.error('Fehler beim Laden der Bilddaten:', error);
            alert('Fehler beim Laden der Bilddaten. Bitte versuchen Sie es sp√§ter erneut.');
          });
      }
      
      // L√∂schbest√§tigung √∂ffnen
      function openDeleteConfirmation(id, type) {
        if (type === 'image') {
          currentImageId = id;
          currentGalleryId = null;
          confirmTitle.textContent = 'Bild l√∂schen';
          confirmMessage.textContent = 'Sind Sie sicher, dass Sie dieses Bild l√∂schen m√∂chten? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.';
        } else {
          currentGalleryId = id;
          currentImageId = null;
          confirmTitle.textContent = 'Galerie l√∂schen';
          confirmMessage.textContent = 'Sind Sie sicher, dass Sie diese Galerie l√∂schen m√∂chten? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.';
        }
        
        deleteType = type;
        confirmModal.style.display = 'flex';
      }
      
      // Element l√∂schen
      confirmDeleteBtn.addEventListener('click', function() {
        if (deleteType === 'image' && currentImageId) {
          // Bild l√∂schen
          fetch(`/api/gallery/${currentImageId}`, {
            method: 'DELETE'
          })
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                // Bild aus der Galerie entfernen
                const galleryItem = document.querySelector(`.gallery-item .delete-btn[data-id="${currentImageId}"]`).closest('.gallery-item');
                galleryItem.remove();
                
                // Kategorien neu laden
                loadCategories();
                
                // Bilder f√ºr Lightbox neu sammeln
                collectGalleryItems();
                
                confirmModal.style.display = 'none';
              } else {
                throw new Error(data.error || 'Unbekannter Fehler');
              }
            })
            .catch(error => {
              console.error('Fehler beim L√∂schen des Bildes:', error);
              alert('Fehler beim L√∂schen des Bildes. Bitte versuchen Sie es sp√§ter erneut.');
            });
        } else if (deleteType === 'gallery' && currentGalleryId) {
          // Galerie l√∂schen
          fetch(`/api/galleries/${currentGalleryId}`, {
            method: 'DELETE'
          })
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                // Seite neu laden, um die √Ñnderungen anzuzeigen
                window.location.reload();
              } else {
                throw new Error(data.error || 'Unbekannter Fehler');
              }
            })
            .catch(error => {
              console.error('Fehler beim L√∂schen der Galerie:', error);
              alert('Fehler beim L√∂schen der Galerie. Bitte versuchen Sie es sp√§ter erneut.');
            });
        }
      });
      
      // Bildvorschau anzeigen
      imageFileInput.addEventListener('change', function() {
        if (this.files && this.files[0]) {
          const reader = new FileReader();
          
          reader.onload = function(e) {
            imagePreview.src = e.target.result;
            imagePreview.style.display = 'block';
          };
          
          reader.readAsDataURL(this.files[0]);
        }
      });
      
      // Galerie-Titelbild-Vorschau anzeigen
      galleryCoverInput.addEventListener('change', function() {
        if (this.files && this.files[0]) {
          const reader = new FileReader();
          
          reader.onload = function(e) {
            coverPreview.src = e.target.result;
            coverPreview.style.display = 'block';
          };
          
          reader.readAsDataURL(this.files[0]);
        }
      });
      
      // Bild-Formular absenden
      imageForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData();
        formData.append('title', imageTitleInput.value);
        formData.append('description', imageDescriptionInput.value);
        formData.append('category', imageCategoryInput.value);
        formData.append('display_order', imageOrderInput.value);
        
        if (imageFileInput.files.length > 0) {
          formData.append('image', imageFileInput.files[0]);
        }
        
        // Neues Bild hinzuf√ºgen oder bestehendes aktualisieren
        const url = imageIdInput.value ? `/api/gallery/${imageIdInput.value}` : '/api/gallery';
        const method = imageIdInput.value ? 'PUT' : 'POST';
        
        fetch(url, {
          method: method,
          body: formData
        })
          .then(response => response.json())
          .then(data => {
            // Seite neu laden, um die √Ñnderungen anzuzeigen
            window.location.reload();
          })
          .catch(error => {
            console.error('Fehler beim Speichern des Bildes:', error);
            alert('Fehler beim Speichern des Bildes. Bitte versuchen Sie es sp√§ter erneut.');
          });
      });
      
      // Galerie-Formular absenden
      galleryForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData();
        formData.append('name', galleryNameInput.value);
        formData.append('description', galleryDescriptionInput.value);
        
        if (galleryCoverInput.files.length > 0) {
          formData.append('cover_image', galleryCoverInput.files[0]);
        }
        
        // Neue Galerie erstellen oder bestehende aktualisieren
        const url = galleryIdInput.value ? `/api/galleries/${galleryIdInput.value}` : '/api/galleries';
        const method = galleryIdInput.value ? 'PUT' : 'POST';
        
        fetch(url, {
          method: method,
          body: formData
        })
          .then(response => {
            if (!response.ok) {
              return response.json().then(data => {
                throw new Error(data.error || 'Fehler beim Speichern der Galerie');
              });
            }
            return response.json();
          })
          .then(data => {
            // Seite neu laden, um die √Ñnderungen anzuzeigen
            window.location.reload();
          })
          .catch(error => {
            console.error('Fehler beim Speichern der Galerie:', error);
            alert('Fehler beim Speichern der Galerie: ' + error.message);
          });
      });
      
      // Bearbeiten-Buttons f√ºr Bilder
      document.querySelectorAll('.gallery-item .edit-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          openEditModal(this.dataset.id);
        });
      });
      
      // L√∂schen-Buttons f√ºr Bilder
      document.querySelectorAll('.gallery-item .delete-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          openDeleteConfirmation(this.dataset.id, 'image');
        });
      });
      
      // Bearbeiten-Buttons f√ºr Galerien
      document.querySelectorAll('.gallery-card .edit-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          openAddGalleryModal(this.dataset.id);
        });
      });
      
      // L√∂schen-Buttons f√ºr Galerien
      document.querySelectorAll('.gallery-card .delete-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          openDeleteConfirmation(this.dataset.id, 'gallery');
        });
      });
      
      // Modal schlie√üen
      modalCloseButtons.forEach(btn => {
        btn.addEventListener('click', function() {
          imageModal.style.display = 'none';
          galleryModal.style.display = 'none';
          confirmModal.style.display = 'none';
        });
      });
      
      cancelBtn.addEventListener('click', function() {
        imageModal.style.display = 'none';
      });
      
      galleryCancelBtn.addEventListener('click', function() {
        galleryModal.style.display = 'none';
      });
      
      cancelDeleteBtn.addEventListener('click', function() {
        confirmModal.style.display = 'none';
      });
      
      // Modals schlie√üen, wenn au√üerhalb geklickt wird
      window.addEventListener('click', function(e) {
        if (e.target === imageModal) {
          imageModal.style.display = 'none';
        }
        if (e.target === galleryModal) {
          galleryModal.style.display = 'none';
        }
        if (e.target === confirmModal) {
          confirmModal.style.display = 'none';
        }
      });

      // Bilder ausw√§hlen und in Galerie verschieben
    const selectImagesBtn = document.getElementById('select-images-btn');
    const selectionControls = document.querySelector('.selection-controls');
    const selectedCountEl = document.getElementById('selected-count');
    const cancelSelectionBtn = document.getElementById('cancel-selection');
    const gallerySelect = document.getElementById('gallery-select');
    const moveToGalleryBtn = document.getElementById('move-to-gallery');
    
    let isSelectionMode = false;
    let selectedImages = [];
    
    // Auswahlmodus umschalten
    selectImagesBtn.addEventListener('click', function() {
      isSelectionMode = !isSelectionMode;
      document.body.classList.toggle('selection-mode', isSelectionMode);
      selectImagesBtn.classList.toggle('selection-mode', isSelectionMode);
      
      if (isSelectionMode) {
        // Auswahlmodus aktivieren
        selectionControls.style.display = 'flex';
        
        // Bearbeitungsmodus deaktivieren, falls aktiv
        if (isEditMode) {
          isEditMode = false;
          document.body.classList.remove('edit-mode');
          toggleEditModeBtn.innerHTML = '‚úèÔ∏è';
          toggleEditModeBtn.classList.remove('edit-mode');
        }
        
        // Event-Listener f√ºr Bildauswahl hinzuf√ºgen
        const galleryItems = document.querySelectorAll('.gallery-item');
        galleryItems.forEach(item => {
          item.addEventListener('click', toggleImageSelection);
        });
      } else {
        // Auswahlmodus deaktivieren
        selectionControls.style.display = 'none';
        clearSelection();
        
        // Event-Listener f√ºr Bildauswahl entfernen
        const galleryItems = document.querySelectorAll('.gallery-item');
        galleryItems.forEach(item => {
          item.removeEventListener('click', toggleImageSelection);
        });
      }
    });
    
    // Bildauswahl umschalten
    function toggleImageSelection(e) {
      // Nicht ausw√§hlen, wenn auf einen Kontrollbutton geklickt wurde
      if (e.target.closest('.image-control-btn')) {
        return;
      }
      
      const galleryItem = this;
      const imageId = galleryItem.querySelector('.image-control-btn').dataset.id;
      
      if (galleryItem.classList.contains('selected')) {
        // Auswahl aufheben
        galleryItem.classList.remove('selected');
        selectedImages = selectedImages.filter(id => id !== imageId);
      } else {
        // Bild ausw√§hlen
        galleryItem.classList.add('selected');
        selectedImages.push(imageId);
      }
      
      // Ausgew√§hlte Anzahl aktualisieren
      selectedCountEl.textContent = selectedImages.length;
      
      // "In Galerie verschieben"-Button aktivieren/deaktivieren
      moveToGalleryBtn.disabled = selectedImages.length === 0 || gallerySelect.value === '';
    }
    
    // Auswahl abbrechen
    cancelSelectionBtn.addEventListener('click', function() {
      clearSelection();
    });
    
    // Auswahl zur√ºcksetzen
    function clearSelection() {
      selectedImages = [];
      selectedCountEl.textContent = '0';
      
      const selectedItems = document.querySelectorAll('.gallery-item.selected');
      selectedItems.forEach(item => {
        item.classList.remove('selected');
      });
      
      moveToGalleryBtn.disabled = true;
    }
    
    // Galerie-Auswahl √§ndern
    gallerySelect.addEventListener('change', function() {
      moveToGalleryBtn.disabled = selectedImages.length === 0 || this.value === '';
    });
    
    // Bilder in Galerie verschieben
    moveToGalleryBtn.addEventListener('click', function() {
      const galleryId = gallerySelect.value;
      
      if (selectedImages.length === 0 || galleryId === '') {
        return;
      }
      
      // API-Anfrage zum Verschieben der Bilder
      fetch('/api/gallery/move', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          image_ids: selectedImages,
          gallery_id: galleryId
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Erfolgsmeldung anzeigen
          alert(data.message);
          
          // Seite neu laden, um die √Ñnderungen anzuzeigen
          window.location.reload();
        } else {
          throw new Error(data.error || 'Unbekannter Fehler');
        }
      })
      .catch(error => {
        console.error('Fehler beim Verschieben der Bilder:', error);
        alert('Fehler beim Verschieben der Bilder: ' + error.message);
      });
    });
      {% endif %}
    });
  </script>

  {% include 'design1/footer.html' %}
</body>
</html>