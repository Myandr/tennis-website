<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hardter TV - Termine</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />    <link
    rel="shortcut icon"
    href="{{ url_for('static', filename='favicon.ico') }}"
  />
    <style>
:root {
    --primary-color: #363636;
    --secondary-color: #f0f0f0;
    --accent-color: #929292;
    --text-color: #000000;
    --light-text: #666;
    --border-color: #ddd;
    --event-color-training: #4a7c59;
    --event-color-turnier: #c75146;
    --event-color-sonstiges: #4b86b4;
}

.calendar-container {
    max-width: 1200px;
    margin: 0px auto;
    background: white;
    border-radius: 10px;
    padding: 20px;
}

.calendar-header {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
}

.calendar-header h1 {
    color: var(--primary-color);
    font-size: 2.2rem;
}

.calendar-navigation {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border-color);
}

.calendar-navigation button {
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 5px;
    padding: 8px 15px;
    cursor: pointer;
    font-size: 1rem;
    transition: background 0.3s;
}

#month-year {
    font-size: 1.5rem;
    color: var(--primary-color);
}

.view-toggle {
    display: flex;
    gap: 10px;
}

.view-toggle button {
    background: var(--secondary-color);
    color: var(--text-color);
}

.view-toggle button.active {
    background: var(--primary-color);
    color: white;
}

/* Calendar View */
.calendar-view {
    margin-bottom: 20px;
}

.weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    text-align: center;
    font-weight: bold;
    margin-bottom: 10px;
}

.weekdays div {
    padding: 10px;
    background: var(--primary-color);
    color: white;
}

.days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
}

.day {
    min-height: 100px;
    padding: 5px;
    border: 1px solid var(--border-color);
    position: relative;
}

.day-number {
    font-weight: bold;
    margin-bottom: 5px;
}

.other-month {
    background-color: #f5f5f5;
    color: var(--light-text);
}

.today {
    background-color: rgba(74, 124, 89, 0.1);
    border: 2px solid var(--primary-color);
}

.event {
    margin: 2px 0;
    padding: 3px 5px;
    border-radius: 3px;
    font-size: 0.8rem;
    color: white;
    cursor: pointer;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.event.training {
    background-color: var(--event-color-training);
}

.event.turnier {
    background-color: var(--event-color-turnier);
}

.event.sonstiges {
    background-color: var(--event-color-sonstiges);
}

/* List View */
.list-view {
    margin-bottom: 20px;
}

.event-filters {
    margin-bottom: 15px;
}

.event-filters select {
    padding: 8px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    width: 200px;
}

.events-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.event-item {
    display: flex;
    padding: 15px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    cursor: pointer;
    transition: transform 0.2s;
}

.event-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.event-date {
    min-width: 80px;
    text-align: center;
    padding-right: 15px;
    border-right: 1px solid var(--border-color);
}

.event-day {
    font-size: 1.5rem;
    font-weight: bold;
}

.event-month {
    font-size: 0.9rem;
}

.event-details {
    flex-grow: 1;
    padding-left: 15px;
}

.event-title {
    font-weight: bold;
    margin-bottom: 5px;
}

.event-time, .event-location {
    font-size: 0.9rem;
    color: var(--light-text);
}

.event-category {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 3px;
    font-size: 0.8rem;
    color: white;
    margin-top: 5px;
}

/* Modal */
.modal {
    display: none;
    overflow: scroll;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
}

.modal-content {
    background-color: white;
    margin: 10% auto;
    padding: 20px;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
    width: 80%;
    max-width: 1200px;
    position: relative;

}

.modal-content p {
    margin: 5px 0;
}

.close {
    position: absolute;
    right: 20px;
    top: 15px;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

/* Add Event Form */


.add-event-button {
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 5px;
    padding: 10px 15px;
    cursor: pointer;
    font-size: 1rem;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.add-event-button i {
    font-size: 1.2rem;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 8px;
    border: 1px solid rgb(0, 0, 0);
    border-radius: 5px;
    font-size: 1rem;
}

.form-group textarea {
    min-height: 100px;
    resize: vertical;
}

.form-row {
    display: flex;
    gap: 15px;
}

.form-row .form-group {
    flex: 1;
}

.form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
}

.form-actions button {
    padding: 8px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1rem;
}

.btn-cancel {
    background: var(--secondary-color);
    color: var(--text-color);
}

.btn-submit {
    background: var(--primary-color);
    color: white;
}

.event-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
}

.btn-edit, .btn-delete {
    padding: 5px 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 0.9rem;
}

.btn-edit {
    background: var(--event-color-training);
    color: white;
}

.btn-delete {
    background: var(--event-color-turnier);
    color: white;
}

/* Utility Classes */
.hidden {
    display: none;
}

/* Enhanced Responsive Design */
@media (max-width: 1268px) {
    .calendar-container {
        margin: 0;
        border-radius: 0;
        padding: 10px;
    }

    .calendar-header h1 {
        font-size: 1.5rem;
    }

    #month-year {
        font-size: 1.2rem;
    }

    /* Show week navigation on mobile */
    .mobile-week-nav {
        display: flex;
    }

    /* Adjust calendar grid for mobile */
    .weekdays div {
        padding: 5px;
        font-size: 0.8rem;
    }

    .day {
        min-height: 60px;
        padding: 2px;
    }

    .day-number {
        font-size: 0.8rem;
        text-align: center;
        margin-bottom: 2px;
    }

    /* Stack events vertically on mobile */
    .event {
        margin: 1px;
        padding: 2px;
        font-size: 0.7rem;
        display: flex;
        align-items: center;
    }

    .event::before {
        content: '';
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        margin-right: 3px;
        background-color: currentColor;
    }

    /* Hide events that don't fit */
    .day {
        max-height: 80px;
        overflow: hidden;
    }

    .day.expanded {
        max-height: none;
        z-index: 1;
        position: relative;
        background: white;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .more-events {
        font-size: 0.7rem;
        color: var(--primary-color);
        text-align: center;
        cursor: pointer;
        padding: 2px;
        background: rgba(74, 124, 89, 0.1);
        border-radius: 3px;
    }

}

@media (max-width: 800px) {
    .calendar-container {
        padding: 7px;
        margin: 3px;
    }
    
    .calendar-header h1 {
        font-size: 1.5rem;
    }
    
    .calendar-navigation button {
        padding: 4px 8px;
        font-size: 0.8rem;
    }
    
    .weekdays div {
        padding: 2px;
        font-size: 0.7rem;
    }
    
    .day {
        min-height: 60px;
        padding: 1px;
    }
    
    .day-number {
        font-size: 0.7rem;
        margin-bottom: 2px;
    }
    
    .event {
        margin: 1px 0;
        padding: 1px 2px;
        font-size: 0.6rem;
        border-radius: 2px;
    }
    
    /* Compact list view for mobile */
    .event-filters select {
        width: 100%;
    }
    
    .event-item {
        padding: 8px;
    }
    
    .event-date {
        min-width: 50px;
        padding-right: 8px;
    }
    
    .event-day {
        font-size: 1rem;
    }
    
    .event-month {
        font-size: 0.7rem;
    }
    
    .event-details {
        padding-left: 8px;
    }
    
    .event-title {
        font-size: 0.8rem;
    }
    
    .event-time, .event-location {
        font-size: 0.7rem;
    }
    
    .event-category {
        font-size: 0.7rem;
        padding: 2px 5px;
    }
    
    .modal-content {
        padding: 12px;
        margin: 0 auto;
    }
    
    .close {
        right: 12px;
        top: 10px;
    }
}

/* Extra small devices */
@media (max-width: 560px) {
    .calendar-navigation button {
        font-size: 0.7rem;
    }
    
      .calendar-container {
        padding: 2px;
        margin: 1px;
    }

    #month-year {
        font-size: 0.8rem;
    }
    
    .add-event-button {
      padding: 6px 10px;
      font-size: 0.8rem;
    }
    
    .day {
      min-height: 50px;
    }

    
    .day-number {
        font-size: 0.7rem;
        margin-bottom: 2px;
    }
    
    .event {
        margin: 1px 0;
        padding: 1px 2px;
        font-size: 0.6rem;
        border-radius: 2px;
    }

    
    .event {
        height: 13px;
        overflow: hidden;
    }
    
    .event-dot {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        margin-right: 2px;
    }
}

.event {
    margin: 3px 0;
    padding: 4px 6px;
    border-radius: 4px;
    font-size: 0.85rem;
    color: white;
    cursor: pointer;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    transition: all 0.2s ease;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    font-weight: 500;
    display: flex;
    align-items: center;
}

.event:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.event.training {
    background-color: var(--event-color-training);
    border-left: 3px solid #2a5a39;
}

.event.turnier {
    background-color: var(--event-color-turnier);
    border-left: 3px solid #a33026;
}

.event.sonstiges {
    background-color: var(--event-color-sonstiges);
    border-left: 3px solid #2a5a8a;
}

/* Enhanced Event Item Styling for List View */
.event-item {
    display: flex;
    padding: 15px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    background-color: white;
}

.event-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.event-date {
    min-width: 80px;
    text-align: center;
    padding-right: 15px;
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.event-day {
    font-size: 1.8rem;
    font-weight: bold;
    color: var(--primary-color);
}

.event-month {
    font-size: 1rem;
    text-transform: uppercase;
    color: var(--accent-color);
    letter-spacing: 1px;
}

.event-details {
    flex-grow: 1;
    padding-left: 15px;
}

.event-title {
    font-weight: bold;
    margin-bottom: 8px;
    font-size: 1.1rem;
    color: var(--primary-color);
}

.event-time, .event-location {
    font-size: 0.9rem;
    color: var(--light-text);
    margin-bottom: 4px;
    display: flex;
    align-items: center;
}

.event-time::before {
    content: '⏰';
    margin-right: 5px;
    font-size: 0.9rem;
}

.event-location::before {
    content: '📍';
    margin-right: 5px;
    font-size: 0.9rem;
}

.event-category {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.75rem;
    color: white;
    margin-top: 8px;
    font-weight: 500;
    letter-spacing: 0.5px;
    text-transform: uppercase;
}

.event-category.training {
    background-color: var(--event-color-training);
}

.event-category.turnier {
    background-color: var(--event-color-turnier);
}

.event-category.sonstiges {
    background-color: var(--event-color-sonstiges);
}

/* Enhanced Modal Styling */
.modal-content {
    background-color: white;
    margin: 10% auto;
    padding: 25px;
    border-radius: 10px;
    width: 80%;
    max-width: 600px;
    position: relative;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

.modal-content h2 {
    color: var(--primary-color);
    margin-top: 0;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border-color);
}

.modal-content p {
    margin: 10px 0;
    line-height: 1.5;
}

.close {
    position: absolute;
    right: 20px;
    top: 15px;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    color: var(--light-text);
    transition: color 0.2s;
}

.close:hover {
    color: var(--primary-color);
}

/* Responsive adjustments */
@media (max-width: 800px) {
    .event {
        padding: 3px 5px;
        font-size: 0.75rem;
        border-left-width: 2px;
    }
    
    .event-title {
        font-size: 0.95rem;
    }
    
    .event-day {
        font-size: 1.5rem;
    }
    
    .event-category {
        padding: 3px 8px;
        font-size: 0.7rem;
    }
    
    .event-time::before, .event-location::before {
        font-size: 0.8rem;
    }
}

@media (max-width: 560px) {
    .event {
        height: auto;
        min-height: 16px;
        padding: 2px 4px;
        font-size: 0.7rem;
        margin: 2px 0;
        border-left-width: 2px;
    }
    
    .event::before {
        content: '';
        display: inline-block;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        margin-right: 3px;
        background-color: white;
    }
    
    .event-category {
        padding: 2px 6px;
        font-size: 0.65rem;
        border-radius: 12px;
    }
    
    .event-day {
        font-size: 1.2rem;
    }
    
    .event-month {
        font-size: 0.8rem;
    }
}
</style>
<style>
/* Enhanced Modal Styling for Event Details */
.modal-content {
    background-color: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    position: relative;
}

/* Event Title in Modal */
#event-modal h2 {
    color: var(--primary-color);
    margin-top: 0;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 2px solid var(--border-color);
    font-size: 1.8rem;
    font-weight: 600;
}

/* Event Details in Modal */
#event-modal p {
    margin: 12px 0;
    line-height: 1.6;
    font-size: 1.05rem;
    display: flex;
    align-items: center;
    color: var(--text-color);
}

/* Event Date in Modal */
#event-date {
    font-weight: 500;
    color: var(--primary-color);
    margin-bottom: 15px;
    padding-left: 28px;
    position: relative;
}

#event-date::before {
    content: '\f073';
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
    position: absolute;
    left: 0;
    color: var(--primary-color);
}

/* Event Time in Modal */
#event-time {
    padding-left: 28px;
    position: relative;
}

#event-time::before {
    content: '\f017';
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
    position: absolute;
    left: 0;
    color: var(--event-color-training);
}

/* Event Location in Modal */
#event-location {
    padding-left: 28px;
    position: relative;
}

#event-location::before {
    content: '\f3c5';
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
    position: absolute;
    left: 0;
    color: var(--event-color-turnier);
}

/* Event Description in Modal */
#event-description {
    margin-top: 20px;
    padding: 15px;
    background-color: #f9f9f9;
    border-radius: 8px;
    border-left: 4px solid var(--accent-color);
    font-style: italic;
    color: #444;
    line-height: 1.6;
}

/* Empty description handling */
#event-description:empty {
    display: none;
}

/* Event Actions in Modal */
.event-actions {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    margin-top: 25px;
    padding-top: 15px;
    border-top: 1px solid var(--border-color);
}

.btn-edit, .btn-delete {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.95rem;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
}

.btn-edit::before {
    content: '\f044';
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
}

.btn-delete::before {
    content: '\f2ed';
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
}

.btn-edit {
    background: var(--event-color-training);
    color: white;
}

.btn-edit:hover {
    background: #3a6c49;
    transform: translateY(-2px);
}

.btn-delete {
    background: var(--event-color-turnier);
    color: white;
}

.btn-delete:hover {
    background: #b74136;
    transform: translateY(-2px);
}

.close {
    position: absolute;
    right: 20px;
    top: 15px;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    color: var(--light-text);
    transition: color 0.2s, transform 0.2s;
    z-index: 10;
}

.close:hover {
    color: var(--primary-color);
}

/* Responsive adjustments for modal */
@media (max-width: 800px) {
    .modal-content {
        padding: 20px;
        width: 90%;
    }
    
    #event-modal h2 {
        font-size: 1.5rem;
        margin-bottom: 15px;
        padding-bottom: 10px;
    }
    
    #event-modal p {
        font-size: 0.95rem;
        margin: 10px 0;
    }
    
    #event-description {
        padding: 12px;
        margin-top: 15px;
    }
}

@media (max-width: 560px) {
    .modal-content {
        padding: 15px;
        width: 95%;
    }
    
    #event-modal h2 {
        font-size: 1.3rem;
        margin-right: 20px; /* Space for close button */
    }
    
    #event-modal p {
        font-size: 0.9rem;
    }
    
    #event-date, #event-time, #event-location {
        padding-left: 24px;
    }
    
    .btn-edit, .btn-delete {
        padding: 6px 12px;
        font-size: 0.85rem;
    }
    
    .close {
        right: 15px;
        top: 10px;
        font-size: 24px;
    }
}
</style>
    </style>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/index2.css') }}" />
</head>
<body>
    {% include 'design1/navbar.html' %}

 <section class="locations-section" style="background-color: white; color: black;">
    <div class="calendar-container">
        <div class="calendar-header">
            <h1>Termine</h1>
        </div>
        {% if is_admin %}
        <button id="add-event-btn" class="add-event-button">
            <i class="fa fa-plus" style="color: white;"></i> Termin hinzufügen
        </button>
        {% endif %}

        <div class="calendar-navigation">
            <button id="prev-month"><i class="fa fa-arrow-left" style="color: white;"></i></button>
            <h2 id="month-year">Februar 2025</h2>
            <button id="next-month"><i class="fa fa-arrow-right" style="color: white;"></i></button>
            <div class="view-toggle">
                <button id="calendar-view-btn" class="active">Kalender</button>
                <button id="list-view-btn">Liste</button>
            </div>
        </div>

        <div id="calendar-view" class="calendar-view">
            <div class="weekdays">
                <div>Mo</div>
                <div>Di</div>
                <div>Mi</div>
                <div>Do</div>
                <div>Fr</div>
                <div>Sa</div>
                <div>So</div>
            </div>
            <div id="calendar-days" class="days">
                <!-- Days will be filled by JavaScript -->
            </div>
        </div>

        <div id="list-view" class="list-view hidden">
            <div class="event-filters">
                <select id="event-category">
                    <option value="all">Alle Kategorien</option>
                    <option value="training">Training</option>
                    <option value="turnier">Turniere</option>
                    <option value="sonstiges">Sonstiges</option>
                </select>
            </div>
            <div id="events-list">
                <!-- Events will be filled by JavaScript -->
            </div>
        </div>

        <!-- Event Details Modal -->
        <div id="event-modal" class="modal" style="overflow: scroll;">
            <div class="modal-content" style="height: 50vh; top: 100%; transform: translate(0, -100%); margin: 0 auto; border-radius: 0; border-top-left-radius: 10px; border-top-right-radius: 10px;">
                <span class="close">&times;</span>
                <h2 id="event-title"></h2>
                <p id="event-date"></p>
                <p id="event-time"></p>
                <p id="event-location"></p>
                <p id="event-description"></p>
                {% if is_admin %}
                <div class="event-actions">
                    <button id="edit-event-btn" class="btn-edit">Bearbeiten</button>
                    <button id="delete-event-btn" class="btn-delete">Löschen</button>
                </div>
                {% endif %}
            </div>
        </div>



        <!-- Add/Edit Event Modal -->
        <div id="event-form-modal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3 id="form-title">Termin hinzufügen</h3>
                <form id="event-form">
                    <input type="hidden" id="event-id" name="event_id">
                    
                    <div class="form-group">
                        <label for="title" style="color: black;">Titel</label>
                        <input style="border: 1px solid grey;" type="text" id="title" name="title" maxlength="15" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="short_title" style="color: black;">Kurztitel (für mobile Ansicht)</label>
                        <input style="border: 1px solid grey;" type="text" id="short_title" name="short_title" maxlength="5" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="start_date" style="color: black;">Startdatum</label>
                            <input style="border: 1px solid grey;" type="date" id="start_date" name="start_date" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="end_date" style="color: black;">Enddatum (optional)</label>
                            <input style="border: 1px solid grey;" type="date" id="end_date" name="end_date">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="is_all_day">
                            <input type="checkbox" id="is_all_day" name="is_all_day" value="true">
                            <span style="color: black;">Ganztägig</span>
                        </label>
                    </div>
                    
                    <div id="time-fields" class="form-row">
                        <div class="form-group">
                            <label for="start_time" style="color: black;">Startzeit</label>
                            <input style="border: 1px solid grey;" type="time" id="start_time" name="start_time" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="end_time" style="color: black;">Endzeit (optional)</label>
                            <input style="border: 1px solid grey;" type="time" id="end_time" name="end_time">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="category" style="color: black;">Kategorie</label>
                        <select id="category" name="category" required>
                            <option value="">Bitte wählen</option>
                            <option value="training">Training</option>
                            <option value="turnier">Turnier</option>
                            <option value="sonstiges">Sonstiges</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="location" style="color: black;">Ort</label>
                        <input style="border: 1px solid grey;" type="text" id="location" name="location" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="description" style="color: black;">Beschreibung</label>
                        <textarea style="border: 1px solid grey;" id="description" name="description"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn-cancel" id="cancel-form">Abbrechen</button>
                        <button type="submit" class="btn-submit">Speichern</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

{% include 'design1/footer.html' %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // DOM Elements
    const calendarDays = document.getElementById('calendar-days');
    const monthYear = document.getElementById('month-year');
    const prevMonthBtn = document.getElementById('prev-month');
    const nextMonthBtn = document.getElementById('next-month');
    const calendarViewBtn = document.getElementById('calendar-view-btn');
    const listViewBtn = document.getElementById('list-view-btn');
    const calendarView = document.getElementById('calendar-view');
    const listView = document.getElementById('list-view');
    const eventsList = document.getElementById('events-list');
    const eventCategoryFilter = document.getElementById('event-category');
    const modal = document.getElementById('event-modal');
    const closeModal = modal.querySelector('.close');
    const eventTitle = document.getElementById('event-title');
    const eventDate = document.getElementById('event-date');
    const eventTime = document.getElementById('event-time');
    const eventLocation = document.getElementById('event-location');
    const eventDescription = document.getElementById('event-description');
    const editEventBtn = document.getElementById('edit-event-btn');
    const deleteEventBtn = document.getElementById('delete-event-btn');
    
    // Add Event Form Elements
    const addEventBtn = document.getElementById('add-event-btn');
    const eventFormModal = document.getElementById('event-form-modal');
    const closeFormModal = eventFormModal.querySelector('.close');
    const cancelFormBtn = document.getElementById('cancel-form');
    const eventForm = document.getElementById('event-form');
    const formTitle = document.getElementById('form-title');
    const eventIdInput = document.getElementById('event-id');
    const isAllDayCheckbox = document.getElementById('is_all_day');
    const timeFields = document.getElementById('time-fields');

    // Current date
    let currentDate = new Date();
    let currentMonth = currentDate.getMonth();
    let currentYear = currentDate.getFullYear();
    
    // Track screen size for responsive adjustments
    let isMobile = window.innerWidth <= 480;
    let isSmallMobile = window.innerWidth <= 360;

    // Store events data
    let events = [];
    
    // Currently selected event (for edit/delete)
    let selectedEvent = null;

    // Month names in German
    const monthNames = [
        'Januar', 'Februar', 'März', 'April', 'Mai', 'Juni',
        'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'
    ];
    
    // Short month names for mobile
    const shortMonthNames = [
        'Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun',
        'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'
    ];

    // Day names in German
    const dayNames = ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'];
    
    // Short day names for mobile
    const shortDayNames = ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'];

    // Initialize calendar
    function initCalendar() {
        // Check initial screen size
        checkScreenSize();
        
        // Fetch events from the server
        fetchEvents();

        // Event listeners
        prevMonthBtn.addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        });

        nextMonthBtn.addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        });

        calendarViewBtn.addEventListener('click', () => {
            calendarView.classList.remove('hidden');
            listView.classList.add('hidden');
            calendarViewBtn.classList.add('active');
            listViewBtn.classList.remove('active');
        });

        listViewBtn.addEventListener('click', () => {
            calendarView.classList.add('hidden');
            listView.classList.remove('hidden');
            calendarViewBtn.classList.remove('active');
            listViewBtn.classList.add('active');
        });

        eventCategoryFilter.addEventListener('change', renderEventsList);

        closeModal.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
            if (event.target === eventFormModal) {
                eventFormModal.style.display = 'none';
            }
        });
        
        // Add event form listeners
        addEventBtn.addEventListener('click', () => {
            openAddEventForm();
        });
        
        closeFormModal.addEventListener('click', () => {
            eventFormModal.style.display = 'none';
        });
        
        cancelFormBtn.addEventListener('click', () => {
            eventFormModal.style.display = 'none';
        });
        
        eventForm.addEventListener('submit', (e) => {
            e.preventDefault();
            saveEvent();
        });
        
        editEventBtn.addEventListener('click', () => {
            if (selectedEvent) {
                openEditEventForm(selectedEvent);
            }
        });
        
        deleteEventBtn.addEventListener('click', () => {
            if (selectedEvent) {
                deleteEvent(selectedEvent.id);
            }
        });
        
        // Listen for screen size changes
        window.addEventListener('resize', () => {
            const wasMobile = isMobile;
            const wasSmallMobile = isSmallMobile;
            
            checkScreenSize();
            
            // Only re-render if mobile status changed
            if (wasMobile !== isMobile || wasSmallMobile !== isSmallMobile) {
                renderCalendar();
                renderEventsList();
            }
        });

        // Add event listener for the all-day checkbox
        isAllDayCheckbox.addEventListener('change', function() {
            if (this.checked) {
                timeFields.style.display = 'none';
                document.getElementById('start_time').required = false;
                document.getElementById('end_time').required = false;
            } else {
                timeFields.style.display = 'flex';
                document.getElementById('start_time').required = false;
                document.getElementById('end_time').required = false;
            }
        });
    }
    
    // Fetch events from the server
    function fetchEvents() {
        fetch('/api/events')
            .then(response => response.json())
            .then(data => {
                // Process events for multi-day support
                let processedEvents = [];
                
                data.forEach(event => {
                    // Check if we have startDate and endDate (for multi-day events)
                    const startDate = event.startDate ? new Date(event.startDate) : new Date(event.date);
                    const endDate = event.endDate ? new Date(event.endDate) : null;
                    
                    // If it's a multi-day event, create an event for each day
                    if (endDate && endDate > startDate) {
                        const currentDate = new Date(startDate);
                        
                        while (currentDate <= endDate) {
                            processedEvents.push({
                                ...event,
                                date: new Date(currentDate),
                                isMultiDay: true,
                                startDate: startDate,
                                endDate: endDate
                            });
                            
                            // Move to next day
                            currentDate.setDate(currentDate.getDate() + 1);
                        }
                    } else {
                        // Single day event
                        processedEvents.push({
                            ...event,
                            date: startDate,
                            isMultiDay: false,
                            startDate: startDate,
                            endDate: null
                        });
                    }
                });
                
                events = processedEvents;
                renderCalendar();
                renderEventsList();
            })
            .catch(error => {
                console.error('Error fetching events:', error);
            });
    }
    
    // Save event (create or update)
    function saveEvent() {
        const formData = new FormData(eventForm);
        const eventId = formData.get('event_id');
        
        // Handle all-day checkbox
        if (isAllDayCheckbox.checked) {
            formData.set('is_all_day', 'true');
            // If all-day is checked, we don't need times
            formData.delete('start_time');
            formData.delete('end_time');
        } else {
            formData.set('is_all_day', 'false');
        }
        
        let url = '/api/events';
        let method = 'POST';
        
        if (eventId && eventId !== '') {
            url = `/api/events/${eventId}`;
            method = 'PUT';
        }
        
        fetch(url, {
            method: method,
            body: formData
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            eventFormModal.style.display = 'none';
            fetchEvents(); // Refresh events
        })
        .catch(error => {
            console.error('Error saving event:', error);
            alert('Fehler beim Speichern des Termins. Bitte versuchen Sie es erneut.');
        });
    }
    
    // Delete event
    function deleteEvent(eventId) {
        if (confirm('Sind Sie sicher, dass Sie diesen Termin löschen möchten?')) {
            fetch(`/api/events/${eventId}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                modal.style.display = 'none';
                fetchEvents(); // Refresh events
            })
            .catch(error => {
                console.error('Error deleting event:', error);
                alert('Fehler beim Löschen des Termins. Bitte versuchen Sie es erneut.');
            });
        }
    }
    
    // Open add event form
    function openAddEventForm() {
        formTitle.textContent = 'Termin hinzufügen';
        eventForm.reset();
        eventIdInput.value = '';
        
        // Set default date to today
        const today = new Date();
        const dateStr = today.toISOString().split('T')[0];
        document.getElementById('start_date').value = dateStr;
        
        // Show time fields by default
        timeFields.style.display = 'flex';
        document.getElementById('start_time').required = false;
        document.getElementById('end_time').required = false;
        
        eventFormModal.style.display = 'block';
    }
    
    // Open edit event form
    function openEditEventForm(event) {
        formTitle.textContent = 'Termin bearbeiten';
        
        // Fill form with event data
        eventIdInput.value = event.id;
        document.getElementById('title').value = event.title;
        document.getElementById('short_title').value = event.shortTitle;
        
        // Set dates
        if (event.startDate) {
            document.getElementById('start_date').value = formatDateForInput(event.startDate);
        } else {
            document.getElementById('start_date').value = formatDateForInput(event.date);
        }
        
        if (event.endDate) {
            document.getElementById('end_date').value = formatDateForInput(event.endDate);
        } else {
            document.getElementById('end_date').value = '';
        }
        
        // Set all-day checkbox
        isAllDayCheckbox.checked = event.isAllDay;
        
        // Show/hide time fields based on all-day status
        if (event.isAllDay) {
            timeFields.style.display = 'none';
            document.getElementById('start_time').required = false;
            document.getElementById('end_time').required = false;
        } else {
            timeFields.style.display = 'flex';
            document.getElementById('start_time').required = false;
            document.getElementById('end_time').required = false;
            document.getElementById('start_time').value = event.startTime;
            document.getElementById('end_time').value = event.endTime;
        }
        
        document.getElementById('location').value = event.location;
        document.getElementById('description').value = event.description || '';
        document.getElementById('category').value = event.category;
        
        // Hide event details modal and show form modal
        modal.style.display = 'none';
        eventFormModal.style.display = 'block';
    }
    
    // Format date for input field (YYYY-MM-DD)
    function formatDateForInput(date) {
        if (typeof date === 'string') {
            return date;
        }
        
        const d = new Date(date);
        let month = '' + (d.getMonth() + 1);
        let day = '' + d.getDate();
        const year = d.getFullYear();
        
        if (month.length < 2) month = '0' + month;
        if (day.length < 2) day = '0' + day;
        
        return [year, month, day].join('-');
    }
    
    // Check screen size for responsive adjustments
    function checkScreenSize() {
        isMobile = window.innerWidth <= 480;
        isSmallMobile = window.innerWidth <= 360;
    }

    // Render calendar
    function renderCalendar() {
        // Update month and year display
        monthYear.textContent = `${monthNames[currentMonth]} ${currentYear}`;

        // Clear previous days
        calendarDays.innerHTML = '';

        // Get first day of month
        const firstDay = new Date(currentYear, currentMonth, 1);
        
        // Get last day of month
        const lastDay = new Date(currentYear, currentMonth + 1, 0);
        
        // Get day of week for first day (0 = Sunday, 1 = Monday, etc.)
        // Adjust for Monday as first day of week
        let firstDayIndex = firstDay.getDay() - 1;
        if (firstDayIndex < 0) firstDayIndex = 6; // Sunday becomes last day
        
        // Get number of days in month
        const daysInMonth = lastDay.getDate();
        
        // Get number of days in previous month
        const prevLastDay = new Date(currentYear, currentMonth, 0);
        const prevDaysInMonth = prevLastDay.getDate();
        
        // Calculate total cells needed (previous month days + current month days + next month days)
        const totalCells = Math.ceil((daysInMonth + firstDayIndex) / 7) * 7;
        
        // Current date for highlighting today
        const today = new Date();
        
        // Render days from previous month
        for (let i = firstDayIndex - 1; i >= 0; i--) {
            const dayElement = document.createElement('div');
            dayElement.classList.add('day', 'other-month');
            
            const dayNumber = document.createElement('div');
            dayNumber.classList.add('day-number');
            dayNumber.textContent = prevDaysInMonth - i;
            
            dayElement.appendChild(dayNumber);
            calendarDays.appendChild(dayElement);
        }
        
        // Render days of current month
        for (let i = 1; i <= daysInMonth; i++) {
            const dayElement = document.createElement('div');
            dayElement.classList.add('day');
            
            // Check if it's today
            if (i === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear()) {
                dayElement.classList.add('today');
            }
            
            const dayNumber = document.createElement('div');
            dayNumber.classList.add('day-number');
            dayNumber.textContent = i;
            
            dayElement.appendChild(dayNumber);
            
            // Add events for this day
            const currentDateObj = new Date(currentYear, currentMonth, i);
            const dayEvents = events.filter(event => {
                const eventDate = new Date(event.date);
                return eventDate.getDate() === i && 
                       eventDate.getMonth() === currentMonth && 
                       eventDate.getFullYear() === currentYear;
            });
            
            dayEvents.forEach(event => {
                const eventElement = document.createElement('div');
                eventElement.classList.add('event', event.category);
                
                // For very small screens, just show a colored dot
                if (isSmallMobile) {
                    const eventDot = document.createElement('span');
                    eventDot.classList.add('event-dot');
                    eventDot.style.backgroundColor = getEventColor(event.category);
                    
                    const eventText = document.createElement('span');
                    eventText.textContent = event.shortTitle;
                    
                    eventElement.appendChild(eventDot);
                    eventElement.appendChild(eventText);
                } else if (isMobile) {
                    // For mobile screens, use the short title
                    if (event.isAllDay) {
                        eventElement.textContent = event.shortTitle;
                    } else {
                        eventElement.textContent = `${event.startTime.substring(0, 2)} ${event.shortTitle}`;
                    }
                    
                    // Add multi-day indicator
                    if (event.isMultiDay) {
                        eventElement.style.borderLeft = '3px solid #ff9800';
                    }
                } else {
                    // For larger screens, use the full title
                    if (event.isAllDay) {
                        eventElement.textContent = event.title;
                    } else {
                        eventElement.textContent = `${event.startTime} ${event.title}`;
                    }
                    
                    // Add multi-day indicator
                    if (event.isMultiDay) {
                        eventElement.style.borderLeft = '3px solid #ff9800';
                    }
                }
                
                eventElement.addEventListener('click', () => showEventDetails(event));
                dayElement.appendChild(eventElement);
            });
            
            calendarDays.appendChild(dayElement);
        }
        
        // Render days from next month
        const remainingCells = totalCells - (firstDayIndex + daysInMonth);
        for (let i = 1; i <= remainingCells; i++) {
            const dayElement = document.createElement('div');
            dayElement.classList.add('day', 'other-month');
            
            const dayNumber = document.createElement('div');
            dayNumber.classList.add('day-number');
            dayNumber.textContent = i;
            
            dayElement.appendChild(dayNumber);
            calendarDays.appendChild(dayElement);
        }
    }

    // Get event color based on category
    function getEventColor(category) {
        switch(category) {
            case 'training':
                return 'var(--event-color-training)';
            case 'turnier':
                return 'var(--event-color-turnier)';
            case 'sonstiges':
                return 'var(--event-color-sonstiges)';
            default:
                return 'var(--primary-color)';
        }
    }

    // Render events list
    function renderEventsList() {
        // Clear previous events
        eventsList.innerHTML = '';
        
        // Get selected category
        const selectedCategory = eventCategoryFilter.value;
        
        // Filter events by category if needed
        let filteredEvents = events;
        if (selectedCategory !== 'all') {
            filteredEvents = events.filter(event => event.category === selectedCategory);
        }
        
        // For list view, we want to show each event only once, even if it spans multiple days
        // So we need to deduplicate multi-day events
        const uniqueEvents = [];
        const eventIds = new Set();
        
        filteredEvents.forEach(event => {
            if (!eventIds.has(event.id)) {
                eventIds.add(event.id);
                uniqueEvents.push(event);
            }
        });
        
        // Sort events by date
        uniqueEvents.sort((a, b) => new Date(a.date) - new Date(b.date));
        
        // Create event items
        if (uniqueEvents.length === 0) {
            const noEvents = document.createElement('p');
            noEvents.textContent = 'Keine Termine gefunden.';
            eventsList.appendChild(noEvents);
        } else {
            uniqueEvents.forEach(event => {
                const eventItem = document.createElement('div');
                eventItem.classList.add('event-item');
                eventItem.addEventListener('click', () => showEventDetails(event));
                
                const eventDate = document.createElement('div');
                eventDate.classList.add('event-date');
                
                const eventDay = document.createElement('div');
                eventDay.classList.add('event-day');
                eventDay.textContent = new Date(event.date).getDate();
                
                const eventMonth = document.createElement('div');
                eventMonth.classList.add('event-month');
                
                // Use short month names on mobile
                if (isMobile) {
                    eventMonth.textContent = shortMonthNames[new Date(event.date).getMonth()];
                } else {
                    eventMonth.textContent = monthNames[new Date(event.date).getMonth()].substring(0, 3);
                }
                
                eventDate.appendChild(eventDay);
                eventDate.appendChild(eventMonth);
                
                const eventDetails = document.createElement('div');
                eventDetails.classList.add('event-details');
                
                const eventTitle = document.createElement('div');
                eventTitle.classList.add('event-title');
                
                // Use short title on small mobile
                if (isSmallMobile) {
                    eventTitle.textContent = event.shortTitle;
                } else {
                    eventTitle.textContent = event.title;
                }
                
                // Add multi-day indicator if applicable
                if (event.isMultiDay) {
                    const multiDayBadge = document.createElement('span');
                    multiDayBadge.textContent = ' (Mehrtägig)';
                    multiDayBadge.style.fontSize = '0.8rem';
                    multiDayBadge.style.color = 'var(--light-text)';
                    eventTitle.appendChild(multiDayBadge);
                }
                
                const eventTime = document.createElement('div');
                eventTime.classList.add('event-time');
                
                // Display time information based on whether it's an all-day event
                if (event.isAllDay) {
                    eventTime.textContent = 'Ganztägig';
                } else {
                    eventTime.textContent = `${event.startTime} - ${event.endTime} Uhr`;
                }
                
                const eventLocation = document.createElement('div');
                eventLocation.classList.add('event-location');
                
                // Abbreviate location on mobile
                if (isMobile && event.location.length > 15) {
                    const locationParts = event.location.split(' ');
                    if (locationParts.length > 1) {
                        eventLocation.textContent = locationParts[0] + '...';
                    } else {
                        eventLocation.textContent = event.location.substring(0, 15) + '...';
                    }
                } else {
                    eventLocation.textContent = event.location;
                }
                
                const eventCategory = document.createElement('div');
                eventCategory.classList.add('event-category', event.category);
                
                let categoryText = '';
                switch(event.category) {
                    case 'training':
                        categoryText = 'Training';
                        break;
                    case 'turnier':
                        categoryText = 'Turnier';
                        break;
                    case 'sonstiges':
                        categoryText = 'Sonstiges';
                        break;
                }
                
                // Abbreviate category text on small mobile
                if (isSmallMobile) {
                    switch(event.category) {
                        case 'training':
                            categoryText = 'Tr';
                            break;
                        case 'turnier':
                            categoryText = 'Tu';
                            break;
                        case 'sonstiges':
                            categoryText = 'So';
                            break;
                    }
                }
                
                eventCategory.textContent = categoryText;
                
                eventDetails.appendChild(eventTitle);
                eventDetails.appendChild(eventTime);
                eventDetails.appendChild(eventLocation);
                eventDetails.appendChild(eventCategory);
                
                eventItem.appendChild(eventDate);
                eventItem.appendChild(eventDetails);
                
                eventsList.appendChild(eventItem);
            });
        }
    }

    // Show event details in modal
    function showEventDetails(event) {
        selectedEvent = event;
        
        eventTitle.textContent = event.title;
        
        // Format date based on screen size and whether it's a multi-day event
        let formattedDate;
        if (event.isMultiDay) {
            const startDate = new Date(event.startDate);
            const endDate = new Date(event.endDate);
            
            if (isMobile) {
                formattedDate = `${startDate.getDate()}. ${shortMonthNames[startDate.getMonth()]} - ${endDate.getDate()}. ${shortMonthNames[endDate.getMonth()]} ${endDate.getFullYear()}`;
            } else {
                formattedDate = `${startDate.getDate()}. ${monthNames[startDate.getMonth()]} - ${endDate.getDate()}. ${monthNames[endDate.getMonth()]} ${endDate.getFullYear()}`;
            }
        } else {
            const eventDateObj = new Date(event.date);
            if (isMobile) {
                formattedDate = `${shortDayNames[eventDateObj.getDay()]}, ${eventDateObj.getDate()}. ${shortMonthNames[eventDateObj.getMonth()]} ${eventDateObj.getFullYear()}`;
            } else {
                formattedDate = `${dayNames[eventDateObj.getDay()]}, ${eventDateObj.getDate()}. ${monthNames[eventDateObj.getMonth()]} ${eventDateObj.getFullYear()}`;
            }
        }
        
        eventDate.textContent = formattedDate;
        
        // Display time information based on whether it's an all-day event
        if (event.isAllDay) {
            eventTime.textContent = 'Ganztägig';
        } else {
            eventTime.textContent = `Zeit: ${event.startTime} - ${event.endTime} Uhr`;
        }
        
        eventLocation.textContent = `Ort: ${event.location}`;
        eventDescription.textContent = event.description || '';
        
        modal.style.display = 'block';
    }

    // Format date as DD.MM.YYYY
    function formatDate(date) {
        return `${date.getDate().toString().padStart(2, '0')}.${(date.getMonth() + 1).toString().padStart(2, '0')}.${date.getFullYear()}`;
    }

    // Initialize the calendar
    initCalendar();
});
</script>
</body>
</html>
